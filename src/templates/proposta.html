{% extends "base.html" %}

{% block title %}Proposta - {{ proposta.nome_indicado }} - Bowe Energia{% endblock %}

{% block styles %}
<!-- CSS avançado com psicologia de vendas para a página de proposta -->
<link rel="stylesheet" href="{{ url_for('static', filename='css/bowe_professional.css') }}">
<link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
<style>
/* Estilos específicos para garantir que o novo layout funcione corretamente */
body { 
    background-color: #f8f9fa;
    padding: 0;
    margin: 0;
    font-family: 'Montserrat', sans-serif;
}
.navbar, footer {
    display: none; /* Oculta a navbar e footer padrão na página de proposta */
}
main {
    padding: 0;
    margin: 0;
}
</style>
{% endblock %}

{% block content %}
<div class="proposal-container" id="proposal-content">
    <div class="header">
        <div class="header-content">
            <div class="logo-container">
                <img src="{{ url_for('static', filename='img/logo.png') }}" alt="Bowe Energia Logo" class="logo-icon">
            </div>
            <div class="subtitle">Simulação de Proposta Energética</div>
        </div>
    </div>

    <div class="proposal-content">
        <!-- Informações do Cliente -->
        <div class="client-info">
            <h2 class="section-title"><i class="fas fa-user"></i> Informações do Cliente</h2>
            <div class="info-grid">
                <div class="info-item">
                    <span class="info-label">Nome do Cliente</span>
                    <span class="info-value">{{ proposta.nome_indicado }}</span>
                </div>
                <div class="info-item">
                    <span class="info-label">Unidade Consumidora</span>
                    <span class="info-value">{{ proposta.unidade_consumidora }}</span>
                </div>
                <div class="info-item">
                    <span class="info-label">Tipo de Rede</span>
                    <span class="info-value">{{ proposta.tipo_rede }}</span>
                </div>
                <div class="info-item">
                    <span class="info-label">Consumo Indicado</span>
                    <span class="info-value">{{ "{:,.0f}".format(proposta.consumo_indicado|int).replace(',', '.') }} kWh</span>
                </div>
                <div class="info-item">
                    <span class="info-label">Mês de Referência</span>
                    <span class="info-value">{{ proposta.mes_atual }}</span>
                </div>
                <div class="info-item">
                    <span class="info-label">Status</span>
                    {% set status_class = "status-pendente" %}
                    {% if proposta.status == "Aprovada" %}
                        {% set status_class = "status-aprovada" %}
                    {% elif proposta.status == "Recusada" %}
                        {% set status_class = "status-recusada" %}
                    {% endif %}
                    <span class="status-badge {{ status_class }}">{{ proposta.status or "Pendente" }}</span>
                </div>
            </div>
        </div>

        <!-- Análise Financeira -->
        <div class="section financial-analysis">
            <h2 class="section-title"><i class="fas fa-chart-line"></i> Análise Financeira</h2>
            <div class="financial-cards">
                <!-- Valor Atual - Vermelho para criar urgência e destacar o problema -->
                <div class="financial-card current">
                    <div class="card-title">
                        <i class="fas fa-exclamation-circle"></i> Valor Atual (Concessionária s/ Bandeira)
                        <span class="card-indicator"><i class="fas fa-bolt"></i></span>
                    </div>
                    <div class="card-value">R$ {{ "{:,.2f}".format(proposta.pagar_energisa).replace(',', '.').replace('.', ',') }}</div>
                    <div class="value-comparison expensive">
                        <i class="fas fa-arrow-up"></i> Tarifa padrão da concessionária
                    </div>
                </div>
                
                {% if proposta.taxa_bandeira > 0 %}
                <!-- Adicional de Bandeira - Neutro para menor ênfase -->
                <div class="financial-card neutral">
                    <div class="card-title">
                        <i class="fas fa-flag"></i> Adicional de Bandeira
                    </div>
                    <div class="card-value">R$ {{ "{:,.2f}".format(proposta.pagar_energisa_mais_bandeira - proposta.pagar_energisa).replace(',', '.').replace('.', ',') }}</div>
                </div>
                
                <!-- Total Atual - Azul escuro para mostrar importância -->
                <div class="financial-card total">
                    <div class="card-title">
                        <i class="fas fa-calculator"></i> Total Atual com Bandeira
                    </div>
                    <div class="card-value">R$ {{ "{:,.2f}".format(proposta.pagar_energisa_mais_bandeira).replace(',', '.').replace('.', ',') }}</div>
                    <div class="trust-badge">
                        <i class="fas fa-check-circle"></i> Valor verificado
                    </div>
                </div>
                {% else %}
                <!-- Adicional de Bandeira - Neutro para menor ênfase -->
                <div class="financial-card neutral">
                    <div class="card-title">
                        <i class="fas fa-flag"></i> Adicional de Bandeira
                    </div>
                    <div class="card-value">R$ 0,00</div>
                </div>
                
                <!-- Total Atual - Azul escuro para mostrar importância -->
                <div class="financial-card total">
                    <div class="card-title">
                        <i class="fas fa-calculator"></i> Total Atual
                    </div>
                    <div class="card-value">R$ {{ "{:,.2f}".format(proposta.pagar_energisa_mais_bandeira).replace(',', '.').replace('.', ',') }}</div>
                    <div class="trust-badge">
                        <i class="fas fa-check-circle"></i> Valor verificado
                    </div>
                </div>
                {% endif %}
                
                <!-- Valor com Bowe - Verde para representar a solução e economia -->
                <div class="financial-card highlight">
                    <div class="card-title">
                        <i class="fas fa-leaf"></i> Valor com Bowe ({{ "{:.1f}".format(proposta.percentual_desconto).replace('.', ',') }}% desconto)
                        <span class="card-indicator"><i class="fas fa-star"></i></span>
                    </div>
                    <div class="card-value">R$ {{ "{:,.2f}".format(proposta.pagar_enersim).replace(',', '.').replace('.', ',') }}</div>
                    <div class="value-comparison savings">
                        <i class="fas fa-arrow-down"></i> Economia garantida com energia renovável
                    </div>
                </div>
            </div>
        </div>

        <!-- Destaque da Economia - Tratamento especial para o ponto-chave de venda -->
        <div class="economy-highlight">
            <div class="economy-title"><i class="fas fa-coins"></i> Sua Economia Mensal</div>
            <div class="economy-value">R$ {{ "{:,.2f}".format(proposta.economia).replace(',', '.').replace('.', ',') }}</div>
            <div class="economy-subtitle">Economia anual estimada de R$ {{ "{:,.2f}".format(proposta.economia_anual).replace(',', '.').replace('.', ',') }} ({{ "{:.1f}".format(proposta.percentual_desconto).replace('.', ',') }}% de desconto)</div>
            <div class="trust-badge">
                <i class="fas fa-shield-alt"></i> Garantia de economia
            </div>
        </div>

        <!-- Ações -->
        <div class="actions">
            <!-- Approve Form - Botão de destaque -->
            <form action="{{ url_for('proposta.resposta', id_publico=proposta.id_publico) }}" method="POST">
                <input type="hidden" name="resposta" value="aprovar">
                <button type="submit" class="btn btn-success">
                    <i class="fas fa-check"></i> Aprovar Proposta
                </button>
            </form>
            
            <!-- Reject Form - Menos destaque -->
            <form action="{{ url_for('proposta.resposta', id_publico=proposta.id_publico) }}" method="POST">
                <input type="hidden" name="resposta" value="recusar">
                <button type="submit" class="btn btn-danger">
                    <i class="fas fa-times"></i> Recusar Proposta
                </button>
            </form>
            
            <!-- Falar com Atendente -->
            <a href="https://wa.me/5500000000000?text=Olá, gostaria de falar sobre a proposta {{ proposta.id_publico }}" class="btn btn-primary" target="_blank">
                 <i class="fas fa-headset"></i> Falar com um Atendente
            </a>
        </div>
    </div>

    <div class="footer">
        <img src="{{ url_for('static', filename='img/powered.png') }}" alt="Bowe Energia" class="footer-logo">
        <p>Proposta gerada em: <strong>{{ proposta.data_criacao_brasilia.strftime("%d/%m/%Y às %H:%M") if proposta.data_criacao_brasilia else "N/A" }}</strong></p>
        <p>ID da Proposta: <strong>{{ proposta.id_publico }}</strong></p>
        <p>&copy; 2025 Bowe Energia. Todos os direitos reservados.</p>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    // Adiciona efeitos sutis de animação aos elementos da proposta
    document.addEventListener('DOMContentLoaded', function() {
        // Anima os cards financeiros ao passar o mouse
        const cards = document.querySelectorAll('.financial-card');
        cards.forEach(card => {
            card.addEventListener('mouseenter', function() {
                this.style.transform = 'translateY(-5px)';
                this.style.boxShadow = '0 10px 20px rgba(0,0,0,0.15)';
            });
            
            card.addEventListener('mouseleave', function() {
                if (this.classList.contains('highlight')) {
                    this.style.transform = 'scale(1.02)';
                } else {
                    this.style.transform = 'translateY(0)';
                }
                this.style.boxShadow = '';
            });
        });
        
        // Adiciona efeito de brilho aos botões
        const buttons = document.querySelectorAll('.btn');
        buttons.forEach(button => {
            button.addEventListener('mouseenter', function() {
                const shine = document.createElement('span');
                shine.style.position = 'absolute';
                shine.style.top = '0';
                shine.style.left = '-100%';
                shine.style.width = '100%';
                shine.style.height = '100%';
                shine.style.background = 'linear-gradient(90deg, rgba(255,255,255,0) 0%, rgba(255,255,255,0.2) 50%, rgba(255,255,255,0) 100%)';
                shine.style.transition = 'all 0.6s ease';
                
                this.appendChild(shine);
                
                setTimeout(() => {
                    shine.style.left = '100%';
                }, 50);
                
                setTimeout(() => {
                    shine.remove();
                }, 700);
            });
        });
        
        // Destaca o card de economia com um pulso sutil
        const economyHighlight = document.querySelector('.economy-highlight');
        if (economyHighlight) {
            setTimeout(() => {
                economyHighlight.style.transform = 'scale(1.05)';
                setTimeout(() => {
                    economyHighlight.style.transform = 'scale(1.03)';
                }, 300);
            }, 1000);
        }
    });
</script>
{% endblock %}
