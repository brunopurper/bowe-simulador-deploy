{% extends "base.html" %}

{% block title %}Proposta - {{ proposta.nome_indicado }} - Bowe{% endblock %}

{% block styles %}
<!-- Novo layout CSS apenas para a página de proposta -->
<link rel="stylesheet" href="{{ url_for('static', filename='css/new_layout.css') }}">
<style>
/* Estilos específicos para garantir que o novo layout funcione corretamente */
body { 
    background-color: #f5f5f5;
    padding: 0;
    margin: 0;
}
.navbar, footer {
    display: none; /* Oculta a navbar e footer padrão na página de proposta */
}
main {
    padding: 0;
    margin: 0;
}
</style>
{% endblock %}

{% block content %}
<div class="proposal-container" id="proposal-content">
    <div class="header">
        <div class="logo">⚡ BOWE ENERGIA</div>
        <div class="subtitle">Simulação de Proposta Energética</div>
    </div>

    <div class="proposal-content">
        <!-- Informações do Cliente -->
        <div class="client-info">
            <h2><i class="fas fa-user"></i> Informações do Cliente</h2>
            <div class="info-grid">
                <div class="info-item">
                    <span class="info-label">Nome do Cliente</span>
                    <span class="info-value">{{ proposta.nome_indicado }}</span>
                </div>
                <div class="info-item">
                    <span class="info-label">Unidade Consumidora</span>
                    <span class="info-value">{{ proposta.unidade_consumidora }}</span>
                </div>
                <div class="info-item">
                    <span class="info-label">Tipo de Rede</span>
                    <span class="info-value">{{ proposta.tipo_rede }}</span>
                </div>
                <div class="info-item">
                    <span class="info-label">Consumo Indicado</span>
                    <span class="info-value">{{ proposta.consumo_indicado|int }} kWh</span>
                </div>
                <div class="info-item">
                    <span class="info-label">Mês de Referência</span>
                    <span class="info-value">{{ proposta.mes_atual }}</span>
                </div>
                <div class="info-item">
                    <span class="info-label">Status</span>
                    {% set status_class = "status-pendente" %}
                    {% if proposta.status == "Aprovada" %}
                        {% set status_class = "status-aprovada" %}
                    {% elif proposta.status == "Recusada" %}
                        {% set status_class = "status-recusada" %}
                    {% endif %}
                    <span class="status-badge {{ status_class }}">{{ proposta.status or "Pendente" }}</span>
                </div>
            </div>
        </div>

        <!-- Cálculos Detalhados -->
        <div class="calculations">
            <h2><i class="fas fa-calculator"></i> Análise Financeira</h2>
            <div class="calc-grid">
                <div class="calc-card danger">
                    <div class="calc-title">Valor Atual (Concessionária s/ Bandeira)</div>
                    <div class="calc-value">R$ {{ "%.2f"|format(proposta.pagar_energisa) }}</div>
                </div>
                {% if proposta.taxa_bandeira > 0 %}
                <div class="calc-card">
                    <div class="calc-title">Adicional de Bandeira</div>
                    <div class="calc-value">R$ {{ "%.2f"|format(proposta.pagar_energisa_mais_bandeira - proposta.pagar_energisa) }}</div>
                </div>
                <div class="calc-card danger">
                    <div class="calc-title">Total Atual com Bandeira</div>
                    <div class="calc-value">R$ {{ "%.2f"|format(proposta.pagar_energisa_mais_bandeira) }}</div>
                </div>
                {% else %}
                 <div class="calc-card">
                    <div class="calc-title">Adicional de Bandeira</div>
                    <div class="calc-value">R$ 0.00</div>
                </div>
               <div class="calc-card danger">
                    <div class="calc-title">Total Atual</div>
                    <div class="calc-value">R$ {{ "%.2f"|format(proposta.pagar_energisa_mais_bandeira) }}</div>
                </div>
                {% endif %}
                <div class="calc-card highlight">
                    <div class="calc-title">Valor com Bowe ({{ "%.1f"|format(proposta.percentual_desconto) }}% desconto)</div>
                    <div class="calc-value">R$ {{ "%.2f"|format(proposta.pagar_enersim) }}</div>
                </div>
            </div>
        </div>

        <!-- Destaque da Economia -->
        <div class="economy-highlight">
            <div class="economy-title">Sua Economia Mensal</div>
            <div class="economy-value">R$ {{ "%.2f"|format(proposta.economia) }}</div>
            <div class="economy-subtitle">Economia anual estimada de R$ {{ "%.2f"|format(proposta.economia_anual) }} ({{ "%.1f"|format(proposta.percentual_desconto) }}% de desconto)</div>
        </div>

        <!-- Ações -->
        <div class="actions">
            <!-- Approve/Reject Forms -->
            <form action="{{ url_for("proposta.resposta", id_publico=proposta.id_publico) }}" method="POST" style="display: inline-block; margin: 0; padding: 0;">
                <input type="hidden" name="resposta" value="aprovar">
                <button type="submit" class="btn btn-success">
                    <i class="fas fa-check"></i> Aprovar Proposta
                </button>
            </form>
            <form action="{{ url_for("proposta.resposta", id_publico=proposta.id_publico) }}" method="POST" style="display: inline-block; margin: 0; padding: 0;">
                <input type="hidden" name="resposta" value="recusar">
                <button type="submit" class="btn btn-danger">
                    <i class="fas fa-times"></i> Recusar Proposta
                </button>
            </form>
            
            <!-- Falar com Atendente -->
            <a href="https://wa.me/556592733787?text=Olá, gostaria de falar sobre a proposta {{ proposta.id_publico }}" class="btn btn-primary" target="_blank">
                 <i class="fas fa-headset"></i> Falar com um Atendente
            </a>

            <!-- Removed share and PDF functionality as requested -->
        </div>
    </div>

    <div class="footer">
        <p>Proposta gerada em: <strong>{{ proposta.data_criacao_brasilia.strftime("%d/%m/%Y às %H:%M") if proposta.data_criacao_brasilia else "N/A" }}</strong></p>
        <p>ID da Proposta: <strong>{{ proposta.id_publico }}</strong></p>
    </div>
</div>
{% endblock %}

